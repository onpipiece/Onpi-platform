<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ONPI Token</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root {
      --bg: #0b0e11;
      --card: #1e2329;
      --text: #e6e6e6;
      --gray: #9ca3af;
      --primary: #f0b90b;
      --primary-dark: #c99a0b;
      --accent: #f6465d;
      --green: #02c076;
      --border: #2a2e36;
      --success: #02c076;
      --error: #f6465d;
      --card-gradient: linear-gradient(135deg, #1e2329, #171b21);
    }

    * { margin:0; padding:0; box-sizing:border-box; }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      background: var(--card-gradient);
      border-radius: 16px;
      padding: 32px 24px;
      width: 100%;
      max-width: 480px;
      border: 1px solid var(--border);
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
      margin: auto;
    }

    h1 {
      font-family: 'Orbitron', sans-serif;
      text-align: center;
      color: var(--primary);
      font-size: 2.2rem;
      margin-bottom: 1.5rem;
    }

    .subtitle {
      text-align: center;
      color: var(--gray);
      font-size: 1.05rem;
      margin-bottom: 2rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
      position: relative;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--primary);
      font-weight: 600;
    }

    input {
      width: 100%;
      padding: 14px 40px 14px 16px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #11151b;
      color: white;
      font-size: 1rem;
    }

    input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(240,185,11,0.3);
    }

    input::placeholder { color: var(--gray); }

    .toggle-password {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 1.3rem;
      color: var(--gray);
    }

    button {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 12px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      margin-top: 1rem;
      transition: all 0.2s;
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    button:not(.logout-btn):not(.btn-register):not([style*="background"]), 
    .dashboard-btn:not(.logout-btn),
    .withdraw-btn,
    .package-card .btn-select:not(:disabled),
    .btn-login,
    .btn-telegram,
    .wallet-btn {
      background: var(--primary) !important;
      color: #000 !important;
    }

    button:not(.logout-btn):not(.btn-register):not([style*="background"]):hover:not(:disabled), 
    .dashboard-btn:not(.logout-btn):hover:not(:disabled),
    .withdraw-btn:hover:not(:disabled),
    .package-card .btn-select:not(:disabled):hover,
    .btn-login:hover,
    .btn-telegram:hover,
    .wallet-btn:hover {
      background: var(--primary-dark) !important;
      transform: translateY(-2px);
    }

    .btn-register {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary);
    }

    .logout-btn {
      background: var(--error);
      color: white;
      grid-column: 1 / -1;
    }

    .status {
      margin-top: 1.5rem;
      padding: 14px;
      border-radius: 12px;
      text-align: center;
      font-weight: 600;
      display: none;
    }

    .success { background: rgba(2,192,118,0.2); color: var(--success); }
    .error   { background: rgba(246,70,93,0.2); color: var(--error); }

    .hidden { display: none !important; }

    .sold-balance {
      text-align: center;
      font-size: 2.8rem;
      font-weight: 800;
      color: white;
      margin: 2rem 0;
      padding: 20px;
      border-radius: 16px;
      background: rgba(15,18,23,0.8);
      border: 1px solid var(--primary);
    }

    .sold-balance .usd {
      color: var(--primary);
      font-size: 3.2rem;
    }

    .sold-balance .tokens {
      display: block;
      font-size: 1.4rem;
      color: var(--gray);
      margin-top: 0.5rem;
    }

    .dashboard-actions {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin: 2rem 0;
    }

    .profile-section, .packages-page {
      background: rgba(30, 35, 41, 0.8);
      padding: 24px;
      border-radius: 16px;
      margin-top: 1.5rem;
      border: 1px solid var(--border);
    }

    .package-list {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .package-card {
      background: rgba(30, 35, 41, 0.6);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s;
      position: relative;
    }

    .package-card.expanded {
      margin-bottom: 140px;
    }

    .package-card:hover {
      border-color: var(--primary);
      box-shadow: 0 0 20px rgba(240,185,11,0.2);
      transform: translateY(-4px);
    }

    .package-card h3 {
      color: var(--primary);
      font-size: 1.6rem;
      margin-bottom: 0.5rem;
    }

    .package-card .price {
      font-size: 2.2rem;
      font-weight: 700;
      color: white;
    }

    .package-card .tokens {
      font-size: 1.3rem;
      color: var(--green);
      margin: 0.5rem 0;
    }

    .package-card .profit {
      font-size: 1.1rem;
      color: var(--gray);
    }

    .package-card .btn-select {
      background: var(--primary);
      color: #000;
      margin-top: 1rem;
      padding: 12px;
      font-size: 1.1rem;
      width: 100%;
    }

    .package-card .btn-select:disabled {
      background: #4a5568 !important;
      color: #cbd5e0 !important;
      cursor: not-allowed;
    }

    .dropdown-menu {
      position: relative;
      margin-top: 1rem;
      background: var(--card);
      border: 1px solid var(--primary);
      border-radius: 8px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.5);
      overflow: hidden;
    }

    .dropdown-menu button {
      background: var(--primary);
      color: #000;
      border: none;
      padding: 14px;
      font-size: 1.1rem;
      cursor: pointer;
      width: 100%;
      text-align: center;
    }

    .dropdown-menu button:hover {
      background: var(--primary-dark);
    }

    .wallet-message {
      background: rgba(240,185,11,0.1);
      border: 1px solid var(--primary);
      border-radius: 12px;
      padding: 24px 20px;
      margin: 2rem 0;
      text-align: center;
    }

    .wallet-address-btn {
      background: var(--primary);
      color: #000;
      border: none;
      border-radius: 10px;
      padding: 16px 12px;
      font-size: 1.25rem;
      text-align: center;
      cursor: pointer;
      margin: 1rem auto;
      max-width: 100%;
      word-break: break-all;
      overflow-wrap: break-word;
      transition: background 0.2s;
    }

    .wallet-address-btn:hover {
      background: var(--primary-dark);
    }

    @media (max-width: 480px) {
      .container { padding: 24px 16px; }
      h1 { font-size: 1.9rem; }
      .sold-balance { font-size: 2.2rem; }
      .sold-balance .usd { font-size: 2.6rem; }
      .wallet-address-btn { font-size: 1.15rem; }
    }

    .dashboard-btn, .withdraw-btn, .stake-btn {
      font-size: 1.05rem;
      padding: 14px 20px;
      border-radius: 12px;
      transition: all 0.25s ease;
    }

    .package-card, .stake-card {
      padding: 18px;
      border-radius: 14px;
    }

    .package-card h3, .stake-card h3 {
      font-size: 1.55rem;
    }

    .package-card .price, .stake-card .price {
      font-size: 2.1rem;
    }

    .package-card .tokens, .stake-card .tokens {
      font-size: 1.25rem;
    }
  </style>
</head>
<body>

<!-- PAGINA DE LOGIN -->
<div class="container" id="loginPage">
  <h1>ONPI Token</h1>
  <p class="subtitle">ConecteazƒÉ-te pentru a continua</p>

  <form id="loginForm">
    <div class="form-group">
      <label for="loginCont">Cont (Username)</label>
      <input type="text" id="loginCont" required placeholder="numele_tƒÉu">
    </div>

    <div class="form-group password-group">
      <label for="loginParola">ParolƒÉ</label>
      <input type="password" id="loginParola" required minlength="6">
      <span class="toggle-password" onclick="togglePassword('loginParola')">üëÅ</span>
    </div>

    <button type="submit" class="btn-login">Login</button>
  </form>

  <button class="btn-register" onclick="switchToRegister()">√énregistreazƒÉ-te</button>

  <div id="loginStatus" class="status"></div>
</div>

<!-- PAGINA DE √éNREGISTRARE -->
<div class="container hidden" id="registerPage">
  <h1>ONPI Token</h1>
  <p class="subtitle">CreeazƒÉ-»õi contul pentru a continua.</p>

  <form id="registerForm">
    <div class="form-group">
      <label for="nume">Nume complet</label>
      <input type="text" id="nume" required placeholder="Ion Popescu" minlength="3">
    </div>

    <div class="form-group">
      <label for="cont">Cont (Username)</label>
      <input type="text" id="cont" required placeholder="numele_tƒÉu (doar litere mici, cifre, ._-)" minlength="4">
    </div>

    <div class="form-group password-group">
      <label for="parola">ParolƒÉ</label>
      <input type="password" id="parola" required minlength="6" placeholder="Minimum 6 caractere">
      <span class="toggle-password" onclick="togglePassword('parola')">üëÅ</span>
    </div>

    <div class="form-group password-group">
      <label for="confirmParola">ConfirmƒÉ parolƒÉ</label>
      <input type="password" id="confirmParola" required minlength="6" placeholder="Reintrodu parolƒÉ">
      <span class="toggle-password" onclick="togglePassword('confirmParola')">üëÅ</span>
    </div>

    <div class="form-group">
      <label for="email">AdresƒÉ de email</label>
      <input type="email" id="email" required placeholder="exemplu@gmail.com">
    </div>

    <div class="form-group">
      <label for="telegram">ID Telegram</label>
      <input type="text" id="telegram" required placeholder="@numele_tƒÉu">
    </div>

    <div class="form-group">
      <label for="telefon">NumƒÉr de telefon</label>
      <input type="tel" id="telefon" required placeholder="+40 712 345 678">
    </div>

    <div class="terms">
      Prin apƒÉsarea butonului confirm cƒÉ accept termenii »ôi politica de confiden»õialitate.
    </div>

    <button type="submit">√énregistreazƒÉ-mƒÉ</button>
  </form>

  <button class="switch-btn" onclick="switchToLogin()">Am deja cont? ‚Üí Login</button>

  <div id="status" class="status"></div>
</div>

<!-- PAGINA DE DASHBOARD -->
<div class="container hidden" id="dashboardPage">
  <h1 class="dashboard-welcome">Dashboard ONPI</h1>

  <div class="sold-balance">
    <span class="usd" id="dashSoldValue">0</span> $
    <span class="tokens">Sold ONPI: <span id="dashSold">0</span></span>
  </div>

  <div class="sold-balance" style="margin-top:1rem; border-color:var(--green);">
    <span style="color:var(--green);">Stake activ: <span id="dashStakeSold">0</span> ONPI</span>
  </div>

  <button class="withdraw-btn" onclick="goToWithdrawal()">Retragere</button>

  <div class="dashboard-actions">
    <button class="dashboard-btn profile-btn" onclick="openProfile()">üë§ Profil</button>
    <button class="dashboard-btn password-btn" onclick="changePassword()">üîê SchimbƒÉ parolƒÉ</button>
    <button id="btnPackages" class="dashboard-btn packages-btn" onclick="openPackages(false)">üì¶ Pachete</button>
    <button id="btnChangePackage" class="dashboard-btn change-package-btn" onclick="openPackages(true)">üîÑ AdaugƒÉ pachet</button>
    <button class="dashboard-btn stake-btn" onclick="openStake()">üí∞ Stake ONPI</button>
    <button class="dashboard-btn instructions-btn" onclick="openInstructions()">üìñ Instruc»õiuni</button>
    <button class="dashboard-btn logout-btn" onclick="logout()">üö™ Deconectare</button>
  </div>

  <div style="margin-top:2rem; padding:20px; background:rgba(30,35,41,0.8); border-radius:16px; border:1px solid var(--primary); height:320px;">
    <h3 style="text-align:center; color:var(--primary); margin-bottom:1rem;">Evolu»õie pre»õ ONPI (ultimele 24h)</h3>
    <canvas id="priceChart" height="220"></canvas>
  </div>

  <div id="dashboardStatus" class="status"></div>
</div>

<!-- PAGINA PROFIL -->
<div class="container hidden" id="profilePage">
  <h1>Profilul meu</h1>

  <div class="profile-section">
    <p><strong>Nume complet:</strong> <span id="dashNume">‚Äî</span></p>
    <p><strong>Cont (Username):</strong> <span id="dashCont">‚Äî</span></p>
    <p><strong>Email:</strong> <span id="dashEmail">‚Äî</span></p>
    <p><strong>Telegram ID:</strong> <span id="dashTelegram">‚Äî</span></p>
    <p><strong>Telefon:</strong> <span id="dashTelefon">‚Äî</span></p>
    <p><strong>Data √ÆnregistrƒÉrii:</strong> <span id="dashDataInregistrare">‚Äî</span></p>
    <p><strong>Sold ONPI:</strong> <span id="dashSoldPersonal">0</span> ONPI</p>
    <p><strong>Sold Stake:</strong> <span id="dashStakePersonal">0</span> ONPI</p>
    <p><strong>Pachete cumpƒÉrate:</strong> <span id="dashPachete">0</span></p>
    <p><strong>Pachet activ:</strong> <span id="dashActivePackage">‚Äî</span></p>
    <p><strong>Status cont:</strong> <span id="dashStatus">Activ</span></p>
    <p><strong>Adresa wallet Solana:</strong> <span id="dashWallet">‚Äî (nu ai adƒÉugat √ÆncƒÉ)</span></p>
  </div>

  <div style="margin-top:2rem;">
    <button onclick="addWallet()" style="background: var(--primary); color: black; padding: 16px; font-size: 1.2rem;">
      AdaugƒÉ / ModificƒÉ wallet Solana
    </button>
  </div>

  <button onclick="switchToDashboard()" style="margin-top:1.5rem;">√énapoi la dashboard</button>
</div>

<!-- PAGINA PACHETE -->
<div class="container hidden" id="packagesPage">
  <h1>Pachete disponibile</h1>
  <p class="subtitle">Alege pachetul potrivit pentru tine</p>

  <div class="package-list">
    <div class="package-card" id="card1">
      <h3>Basic</h3>
      <div class="price">50$</div>
      <div class="tokens">7.500.000 ONPI (\~<span id="solEq50">calcul√¢nd...</span> SOL)</div>
      <div class="profit">Profit garantat x20 ‚Äì x50</div>
      <div class="dropdown-wrapper">
        <button class="btn-select" onclick="toggleDropdown('card1')">SelecteazƒÉ</button>
        <div class="dropdown-menu" id="dropdown1">
          <button onclick="buyPackage('50')">Achizi»õioneazƒÉ direct √Æn SOL</button>
        </div>
      </div>
    </div>

    <!-- celelalte 3 carduri la fel ca √Ænainte ‚Äì le-am scurtat aici pentru spa»õiu, pune-le √Ænapoi dacƒÉ lipse»ôte -->

  </div>

  <button onclick="switchToDashboard()" style="margin-top:2rem;">√énapoi la dashboard</button>
</div>

<!-- celelalte pagini ‚Äì purchasePage, withdrawalPage, instructionsPage, stakePage, interestCalcPage ‚Äì rƒÉm√¢n neschimbate din codul tƒÉu original -->

<script>
// CONSTANTE
const BOT_TOKEN = '7548290162:AAH0P6XOowBMHvKIggPT-pafIg6RDI3Qj-c';
const CHAT_ID   = '5470225717';
const MY_WALLET = 'B9S74FCa1Ac2AY8osHDK5Hu3PB9m2RovxGMq52a5rbfP';

// Supabase Config
const SUPABASE_URL = 'https://tymrdlvydcfbnxfawxqx.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR5bXJkbHZ5ZGNmYm54ZmF3eHF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzMjcxMTMsImV4cCI6MjA4NjkwMzExM30.txI8mMkPvVs8SR6rNBcHF8F3z175-4peEJF9-M4a4Os';

const supabase = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// Pachete
const packages = {
  '50': 7500000,
  '100': 15000000,
  '200': 30000000,
  '500': 60000000
};

let upgradeMode = false;

// Elemente DOM
const registerForm = document.getElementById('registerForm');
const loginForm = document.getElementById('loginForm');
const registerPage = document.getElementById('registerPage');
const loginPage = document.getElementById('loginPage');
const dashboardPage = document.getElementById('dashboardPage');
const profilePage = document.getElementById('profilePage');
const packagesPage = document.getElementById('packagesPage');
const upgradePage = document.getElementById('upgradePage');
const purchasePage = document.getElementById('purchasePage');
const withdrawalPage = document.getElementById('withdrawalPage');
const instructionsPage = document.getElementById('instructionsPage');
const instructionsGeneralPage = document.getElementById('instructionsGeneralPage');
const stakePage = document.getElementById('stakePage');
const interestCalcPage = document.getElementById('interestCalcPage');
const status = document.getElementById('status');
const loginStatus = document.getElementById('loginStatus');
const dashboardStatus = document.getElementById('dashboardStatus');
const dashSold = document.getElementById('dashSold');
const dashSoldValue = document.getElementById('dashSoldValue');
const dashNume = document.getElementById('dashNume');
const dashCont = document.getElementById('dashCont');
const dashEmail = document.getElementById('dashEmail');
const dashTelegram = document.getElementById('dashTelegram');
const dashTelefon = document.getElementById('dashTelefon');
const dashWallet = document.getElementById('dashWallet');
const dashSoldPersonal = document.getElementById('dashSoldPersonal');
const dashPachete = document.getElementById('dashPachete');
const dashActivePackage = document.getElementById('dashActivePackage');
const personalWalletDisplay = document.getElementById('personalWalletDisplay');
const withdrawalBalance = document.getElementById('withdrawalBalance');
const withdrawalAmount = document.getElementById('withdrawalAmount');

// Hash parolƒÉ
async function hashPassword(parola) {
  const encoder = new TextEncoder();
  const data = encoder.encode(parola);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
}

// Pre»õ SOL
async function getSolPrice() {
  try {
    const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=usd');
    const data = await res.json();
    return data.solana.usd || 85;
  } catch (err) {
    return 85;
  }
}

async function updateSolEquivalents() {
  const solPrice = await getSolPrice();
  ['solEq50','solEq100','solEq200','solEq500','solEqUp50','solEqUp100','solEqUp200','solEqUp500'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.textContent = (parseInt(id.match(/\d+/)[0]) / solPrice).toFixed(4);
  });
}

// Conectare wallet simulatƒÉ
async function connectWallet() {
  if (window.solana && window.solana.isPhantom) {
    try {
      await window.solana.connect();
      return true;
    } catch (err) {
      alert('Conectare e»ôuatƒÉ: ' + err.message);
      return false;
    }
  }
  alert('InstaleazƒÉ Phantom sau Solflare.');
  return false;
}

// Buy package ‚Äì update Supabase
async function buyPackage(value) {
  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) return alert('Trebuie sƒÉ fii logat!');

  const userData = JSON.parse(localStorage.getItem('userData') || '{}');
  const tokens = packages[value] || 0;
  if (tokens === 0) return alert('Pachet invalid!');

  const newBalance = (userData.balance || 0) + tokens;
  const newPackages = [...(userData.purchased_packages || []), value];

  const { error } = await supabase
    .from('users')
    .update({
      balance: newBalance,
      purchased_packages: newPackages,
      activePackage: value
    })
    .eq('cont', loggedInUser);

  if (error) return alert('Eroare: ' + error.message);

  userData.balance = newBalance;
  userData.purchased_packages = newPackages;
  userData.activePackage = value;
  localStorage.setItem('userData', JSON.stringify(userData));

  updateDashboardDisplay(userData);
  alert(`+ ${tokens.toLocaleString('ro-RO')} ONPI adƒÉuga»õi!`);
}

// Stake ‚Äì update Supabase
async function stakeTokens(days) {
  const loggedInUser = localStorage.getItem('loggedInUser');
  if (!loggedInUser) return alert('Trebuie sƒÉ fii logat!');

  const userData = JSON.parse(localStorage.getItem('userData') || '{}');
  const available = userData.balance || 0;

  if (available < 1) return alert('Nu ai suficient ONPI!');

  const minStake = Math.floor(available * 0.5);
  const amount = Number(prompt(`SumƒÉ stake (minim ${minStake}):`, minStake));

  if (isNaN(amount) || amount < minStake || amount > available) return alert('SumƒÉ invalidƒÉ!');

  const rates = { 7: 0.125, 30: 0.189, 90: 0.50 };
  const dailyRate = rates[days] / days;

  const newBalance = available - amount;
  const newStake = { amount, start: Date.now(), days, dailyRate };

  const { error } = await supabase
    .from('users')
    .update({
      balance: newBalance,
      stake: newStake
    })
    .eq('cont', loggedInUser);

  if (error) return alert('Eroare stake: ' + error.message);

  userData.balance = newBalance;
  userData.stake = newStake;
  localStorage.setItem('userData', JSON.stringify(userData));

  updateDashboardDisplay(userData);
  alert(`Stake activat! ${amount} ONPI pentru ${days} zile.`);
}

// Load date din Supabase la dashboard
async function loadUserData() {
  const cont = localStorage.getItem('loggedInUser');
  if (!cont) return;

  const { data, error } = await supabase
    .from('users')
    .select('*')
    .eq('cont', cont)
    .single();

  if (error || !data) {
    logout();
    return;
  }

  localStorage.setItem('userData', JSON.stringify(data));
  updateDashboardDisplay(data);
  updateProfileDisplay(data);
}

// Register
registerForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const nume = document.getElementById('nume').value.trim();
  const cont = document.getElementById('cont').value.trim().toLowerCase();
  const parola = document.getElementById('parola').value.trim();
  const confirmParola = document.getElementById('confirmParola').value.trim();
  const email = document.getElementById('email').value.trim();
  const telegram = document.getElementById('telegram').value.trim();
  const telefon = document.getElementById('telefon').value.trim();

  if (parola !== confirmParola) return alert('Parolele nu coincid');
  if (parola.length < 6) return alert('Parola minim 6 caractere');

  const parolaHash = await hashPassword(parola);

  const { error } = await supabase.from('users').insert({
    cont,
    parola_hash: parolaHash,
    nume,
    email,
    telegram,
    telefon,
    balance: 0,
    purchased_packages: [],
    stake: {},
    data_inregistrare: new Date().toISOString()
  });

  if (error) {
    alert(error.message.includes('duplicate key') ? 'Username deja folosit!' : 'Eroare: ' + error.message);
    return;
  }

  alert('Cont creat! LogheazƒÉ-te.');
  switchToLogin();
});

// Login
loginForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const cont = document.getElementById('loginCont').value.trim().toLowerCase();
  const parola = document.getElementById('loginParola').value.trim();

  const parolaHash = await hashPassword(parola);

  const { data, error } = await supabase
    .from('users')
    .select('*')
    .eq('cont', cont)
    .eq('parola_hash', parolaHash)
    .single();

  if (error || !data) return alert('Cont sau parolƒÉ gre»ôitƒÉ');

  localStorage.setItem('loggedInUser', cont);
  localStorage.setItem('userData', JSON.stringify(data));

  switchToDashboard();
});

// Logout
function logout() {
  localStorage.removeItem('loggedInUser');
  localStorage.removeItem('userData');
  showOnly(loginPage);
}

// Load ini»õial
window.addEventListener('load', async () => {
  if (localStorage.getItem('loggedInUser')) {
    await loadUserData();
    showOnly(dashboardPage);
  } else {
    showOnly(loginPage);
  }

  await updateSolEquivalents();
});

// Restul func»õiilor tale (togglePassword, showOnly, updateDashboardDisplay, etc.) ‚Äì copiazƒÉ-le din codul original dacƒÉ lipsesc √Æn acest exemplu
// De exemplu:
function togglePassword(id) {
  const input = document.getElementById(id);
  input.type = input.type === 'password' ? 'text' : 'password';
}

// ... adaugƒÉ restul func»õiilor tale aici (switchToLogin, switchToRegister, openProfile, etc.)

</script>

</body>
</html>
